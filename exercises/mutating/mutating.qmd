# Mutating data

One of the most common data analysis techniques is to look at change over time. The most common way of comparing change over time is through percent change. The math behind calculating percent change is very simple, and you should know it off the top of your head. The easy way to remember it is:

`(new - old) / old`

Or new minus old divided by old. Your new number minus the old number, the result of which is divided by the old number. To do that in R, we can use `dplyr` and `mutate` to calculate new metrics in a new field using existing fields of data.

So first we'll import the tidyverse so we can read in our data and begin to work with it. Go ahead and do that:

```{r}
#| warning: false
#| message: false
library(tidyverse)
```

Now you'll need a common and simple dataset of total attendance at NCAA football games over the last few seasons.

```{r}
#| warning: false
#| message: false
#| results: asis
#| echo: false
library(downloadthis)
library(glue)

dllink <- download_link(
  link = "https://dwillis.github.io/sports-data-files/attendance.csv",
  button_label = "Download csv file",
  button_type = "danger",
  has_icon = TRUE,
  icon = "fa fa-save",
  self_contained = FALSE
)

glue("<pre><p><strong>For this walkthrough:</strong></p><p>{dllink}</p></pre>")

```

You'll import it something like this.

```{r}
attendance <- read_csv('data/attendance.csv')
```

If you want to see the first six rows -- handy to take a peek at your data -- you can use the function `head`.

```{r}
head(attendance)
```

What's one thing you notice about the data that might make year-over-year comparisons more complex?

**Answer** Something that may change the data is that the number of home games isn't always the same each season. If a team hoster fewer games in 2024 than in 2023, their total attendance might appear to have dropped, but that might reflect less oppurtunities for fans to attend. And vise versa, a team that has more home games than another can inflate the year total. 


The code to calculate percent change is pretty simple. Remember, with `summarize`, we used `n()` to count things. With `mutate`, we use very similar syntax to calculate a new value using other values in our dataset. So in this case, we're trying to do (new-old)/old, but we're doing it with fields. If we look at what we got when we did `head`, you'll see there's \`2024\` as the new data, and we'll use \`2023\` as the old data. So we're looking at one year. Then, to help us, we'll use arrange again to sort it, so we get the fastest growing school over one year.

```{r}
attendance |> mutate(
  change = (`2024` - `2023`)/`2023`
) 
```
What do we see right away? Do those numbers look like we expect them to? No. They're a decimal expressed as a percentage. So let's fix that by multiplying by 100. 

```{r}
attendance |> mutate(
  change = ((`2024` - `2023`)/`2023`)*100
) 
```
Now, does this ordering do anything for us? No. Let's fix that with arrange. 

```{r}
attendance |> mutate(
  change = ((`2024` - `2023`)/`2023`)*100
) |> arrange(desc(change))
```

Who had the most growth in 2024 compared to the year before? What could account for that change? And what team(s) are the most interesting here?

**Answer** SMU has the highest change percentage.SMU recently joined the ACC in early 2024 which could explain their boost in attendance. New conference apponents bring more excitment to students and fans. Ohio State is something I find interesting because they are already leading in attendance so it would be cool to find out why.
## Back to women's soccer

Let's turn back to the women's soccer match data from this season. 

Import it like this:

```{r}
matches_2025 <- read_csv("https://raw.githubusercontent.com/dwillis/NCAAWomensSoccerData/main/data/ncaa_womens_soccer_matchstats_2025.csv")
```

Previously we calculated totals for shots attempted and shots on goal for each time. Now let's do shots on goal and goals, using group_by() and summarize(), and then we'll use mutate to add a percentage to that and see what stands out.

```{r}
matches_2025 |> 
  group_by(team) |> 
  summarise(
    total_on_goal = sum(so_g),
    total_goals = sum(goals)
  ) |> 
  mutate(percent = total_goals/total_on_goal *100) |> 
  arrange(desc(percent))
```

What stands out to you here? Describe that below. Would you narrow down the results to certain teams based on the data? If so, do that in the code and explain why you did it below. Finally, what's the most interesting result to you that could be a story?

**Answer** 
SMU increasing by 68% is something that catchwes my attention, because its not a year over year change. Ohio state and Indiana also have large progrms that have large fan bases so to see that much of an increase in suprising. Something else that is interesting in the conference pattern. The schools with the most growth like SMU, Texas, and Oklahoma are ones that were directly involved in recent conference shifts. THis shows that new match ups and conferences are driving attendance. Colorado State and Central Michigan stand out among non-power five schools. That's unusual to see that large of an increase and would be interesting as to why. I would maybe narrow results to schools that generate the most national attention and focus on attendance shifts that have broader implications. The most interesting story angle would be SMU, which is a program that's historically middle tier, that sees a large increase after joining the ACC which portrays a clear narrative that a new conference = new fans. ANother interesting angle would be Ohio States 50.3% increase. Ohio State already domunates in football attendance, so how did they add that many more people? 